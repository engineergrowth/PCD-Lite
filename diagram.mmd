graph TB
    %% User Input Layer
    User[ğŸ‘¤ User] --> VoiceInput[ğŸ¤ Voice Input]
    User --> TextInput[âŒ¨ï¸ Text Input]
    
    %% Input Processing
    VoiceInput --> VoiceProcessor[ğŸ™ï¸ Voice Processor<br/>- Speech-to-Text<br/>- Voice Corrections<br/>- Query Normalization]
    TextInput --> QueryParser[ğŸ” Query Parser<br/>- Natural Language Processing<br/>- Intent Recognition<br/>- Filter Extraction]
    
    %% API Layer
    VoiceProcessor --> FastAPI[ğŸš€ FastAPI Server<br/>- /search endpoint<br/>- /click endpoint<br/>- /debug/last-query<br/>- /analytics endpoints]
    QueryParser --> FastAPI
    
    %% Core Processing
    FastAPI --> MetadataMapper[ğŸ—‚ï¸ Metadata Mapper<br/>- Genre Normalization<br/>- Actor Name Mapping<br/>- Filter Standardization]
    
    %% A/B Testing & Recommendations
    MetadataMapper --> ABTesting{ğŸ§ª A/B Testing<br/>Session-based Assignment}
    ABTesting -->|Variant A| PopularityStrategy[ğŸ“Š Popularity Strategy<br/>- Rule-based Boosts<br/>- Genre Matching<br/>- Actor Matching<br/>- Runtime Preferences]
    ABTesting -->|Variant B| SimilarityStrategy[ğŸ” TF-IDF Strategy<br/>- Cosine Similarity<br/>- Content-based Filtering<br/>- Overview Analysis]
    
    %% Data Layer
    PopularityStrategy --> MovieCatalog[ğŸ¬ Movie Catalog<br/>- 30+ Movies<br/>- Genres, Cast, Overview<br/>- Runtime, Ratings<br/>- Popularity Scores]
    SimilarityStrategy --> MovieCatalog
    
    %% Response Generation
    PopularityStrategy --> ResponseGenerator[ğŸ“‹ Response Generator<br/>- JSON Serialization<br/>- X-Variant Header<br/>- X-Request-Id Header<br/>- Debug Information]
    SimilarityStrategy --> ResponseGenerator
    
    %% Event Logging
    ResponseGenerator --> EventLogger[ğŸ“ Event Logger<br/>- Impression Tracking<br/>- Click Tracking<br/>- Session Management<br/>- Performance Metrics]
    
    %% Storage Layer
    EventLogger --> SQLiteDB[(ğŸ—„ï¸ SQLite Database<br/>- Event Storage<br/>- Session Tracking<br/>- Performance Data)]
    EventLogger --> CSVLogs[(ğŸ“„ CSV Logs<br/>- Event Backup<br/>- Data Export<br/>- Debugging)]
    
    %% Analytics Dashboard
    SQLiteDB --> StreamlitDashboard[ğŸ“Š Streamlit Dashboard<br/>- Real-time Analytics<br/>- A/B Testing Results<br/>- CTR Visualization<br/>- Session Analysis]
    CSVLogs --> StreamlitDashboard
    
    %% Debug & Monitoring
    FastAPI --> DebugEndpoint[ğŸ› Debug Endpoint<br/>- Last Query Info<br/>- Parsed Filters<br/>- Variant Assignment<br/>- Processing Time]
    
    %% External Integrations (Future)
    EventLogger -.->|Future| Kibana[ğŸ“ˆ Kibana<br/>- Log Aggregation<br/>- Real-time Monitoring<br/>- Alerting]
    EventLogger -.->|Future| Splunk[ğŸ” Splunk<br/>- Enterprise Logging<br/>- Advanced Analytics<br/>- Security Monitoring]
    
    %% AWS Cloud (Future)
    FastAPI -.->|Future| LoadBalancer[âš–ï¸ AWS Load Balancer<br/>- Traffic Distribution<br/>- Health Checks<br/>- SSL Termination]
    LoadBalancer -.->|Future| AutoScaling[ğŸ“ˆ Auto Scaling Group<br/>- Dynamic Scaling<br/>- Instance Management<br/>- Cost Optimization]
    
    %% Styling
    classDef userLayer fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef apiLayer fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef processingLayer fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef dataLayer fill:#fff3e0,stroke:#e65100,stroke-width:2px
    classDef analyticsLayer fill:#fce4ec,stroke:#880e4f,stroke-width:2px
    classDef futureLayer fill:#f5f5f5,stroke:#616161,stroke-width:1px,stroke-dasharray: 5 5
    
    class User,VoiceInput,TextInput userLayer
    class FastAPI,DebugEndpoint apiLayer
    class VoiceProcessor,QueryParser,MetadataMapper,ABTesting,PopularityStrategy,SimilarityStrategy,ResponseGenerator,EventLogger processingLayer
    class MovieCatalog,SQLiteDB,CSVLogs dataLayer
    class StreamlitDashboard analyticsLayer
    class Kibana,Splunk,LoadBalancer,AutoScaling futureLayer
